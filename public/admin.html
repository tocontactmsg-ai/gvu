<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© â€” Ø«Ø§Ø¨Øª</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;font-family:"Tajawal",system-ui,Arial,sans-serif}
  body{margin:0;background:#f7fafc;color:#0b1320;padding:14px}
  .wrap{max-width:1000px;margin:0 auto}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  h1{margin:0;font-size:18px}
  .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  input,textarea,select{padding:8px;border-radius:8px;border:1px solid #e6eef8;background:#fff}
  .grid{margin-top:14px}
  .row{display:flex;gap:8px}
  .card{background:#fff;padding:10px;border-radius:10px;border:1px solid #e8eef6;margin-bottom:10px;display:flex;gap:10px;align-items:flex-start}
  .thumb{width:110px;height:80px;object-fit:cover;border-radius:8px;background:#eef3fb}
  .meta{flex:1}
  .actions{display:flex;gap:8px}
  .btn{padding:8px 10px;border-radius:8px;border:none;cursor:pointer;background:#0078d7;color:#fff}
  .danger{background:#d33}
  .muted{color:#667085;font-size:13px}
  .small{font-size:13px;color:#445}
  .modal{position:fixed;inset:0;background:rgba(2,6,23,0.5);display:none;align-items:center;justify-content:center}
  .modal .box{background:#fff;padding:12px;border-radius:10px;max-width:700px;width:100%}
  label{display:block;margin-top:8px;font-weight:700}
  .inline{display:flex;gap:8px;align-items:center}
  pre{background:#f1f7ff;padding:10px;border-radius:8px;overflow:auto}
  .hint{background:#fff7ed;border:1px solid #ffedd5;padding:8px;border-radius:8px;color:#92400e;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© â€” Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø«Ø§Ø¨ØªØ©</h1>
      <div class="muted">Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ Ø«Ù… Ù†Ø²Ù‘Ù„ ads.json ÙˆØ§Ø¯ÙØ¹Ù‡ Ø¥Ù„Ù‰ GitHub</div>
    </div>
    <div>
      <a href="index.html" style="text-decoration:none;color:#0078d7">Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a>
    </div>
  </header>

  <div class="controls" style="margin-top:12px">
    <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù…Ø²/Ø§Ù„Ø¹Ù†ÙˆØ§Ù†/Ø§Ù„ÙˆØµÙ" style="flex:1">
    <button id="newBtn" class="btn">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</button>
    <button id="downloadBtn" style="background:#16a34a" class="btn">ØªÙ†Ø²ÙŠÙ„ ads.json</button>
    <button id="copyBtn" style="background:#6b7280" class="btn">Ù†Ø³Ø® JSON</button>
  </div>

  <div class="hint">
    <strong>ØªÙˆØ¶ÙŠØ­ Ø³Ø±ÙŠØ¹:</strong> Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ù…Ø¹ ØµÙˆØ±Ø©: Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù Ø«Ù… Ø§Ø¶ØºØ· <em>ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø±ÙŠØ¨Ùˆ</em> Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ù„Ù Ø¬Ø§Ù‡Ø² Ù„Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ <code>public/images/</code>. Ø¨Ø¹Ø¯ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù„Ù‰ GitHub Ø­Ø¯Ø« Ø§Ù„Ù…Ø³Ø§Ø± Ø¯Ø§Ø®Ù„ ads.json (Ù…Ø«Ù„ <code>images/name.jpg</code>) Ø«Ù… Ù†Ø²Ù‘Ù„ ads.json ÙˆØ§Ø¯ÙØ¹ Ø¥Ù„Ù‰ GitHub.
  </div>

  <div id="list" class="grid"></div>

  <h3>JSON Ø§Ù„Ù†Ø§ØªØ¬</h3>
  <pre id="out">[]</pre>
</div>

<!-- modal -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="box">
    <h3 id="mTitle">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„</h3>

    <label>Ø±Ù…Ø² Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (code)</label>
    <input id="m_code">

    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
    <input id="m_title">

    <label>Ø§Ù„ÙˆØµÙ</label>
    <textarea id="m_desc" rows="3"></textarea>

    <div class="row">
      <div style="flex:1">
        <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
        <input id="m_loc">
      </div>
      <div style="width:200px">
        <label>Ø§Ù„ØªÙˆØ§ØµÙ„</label>
        <input id="m_contact">
      </div>
    </div>

    <label>Ø§Ù„ØµÙ†Ù / Ø§Ù„ØªØµÙ†ÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input id="m_cat">

    <label>Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€” Ø§Ø®ØªØ± Ù…Ù„Ù Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</label>
    <input id="m_file" type="file" accept="image/*">
    <div id="imgPreview" style="margin-top:8px"></div>

    <label>Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø±ÙŠØ¨Ùˆ (Ø³ÙŠØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù…)</label>
    <input id="m_imgpath" placeholder="images/myphoto.jpg">

    <div class="inline" style="margin-top:10px">
      <button id="saveBtn" class="btn">Ø­ÙØ¸</button>
      <button id="cancelBtn" class="btn" style="background:#6b7280">Ø¥Ù„ØºØ§Ø¡</button>
      <button id="downloadImgBtn" class="btn" style="background:#10b981">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø±ÙŠØ¨Ùˆ</button>
      <button id="copyPathBtn" class="btn" style="background:#f59e0b">Ù†Ø³Ø® Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø©</button>
    </div>

    <div style="margin-top:10px" class="muted small">Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø±ÙŠØ¨Ùˆ ÙŠØªÙ… ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¹Ø¨Ø± GitHub (Upload files) Ø£Ùˆ Ø¹Ø¨Ø± Git Ù…Ø­Ù„ÙŠ Ø«Ù… push.</div>
  </div>
</div>

<script>
const ADS_URL = 'ads.json';
let ADS = [];
let editingIndex = -1;

const listEl = document.getElementById('list');
const outEl = document.getElementById('out');
const searchEl = document.getElementById('search');
const newBtn = document.getElementById('newBtn');
const downloadBtn = document.getElementById('downloadBtn');
const copyBtn = document.getElementById('copyBtn');

const modal = document.getElementById('modal');
const mTitle = document.getElementById('mTitle');
const m_code = document.getElementById('m_code');
const m_title = document.getElementById('m_title');
const m_desc = document.getElementById('m_desc');
const m_loc = document.getElementById('m_loc');
const m_contact = document.getElementById('m_contact');
const m_cat = document.getElementById('m_cat');
const m_file = document.getElementById('m_file');
const m_imgpath = document.getElementById('m_imgpath');
const imgPreview = document.getElementById('imgPreview');
const saveBtn = document.getElementById('saveBtn');
const cancelBtn = document.getElementById('cancelBtn');
const downloadImgBtn = document.getElementById('downloadImgBtn');
const copyPathBtn = document.getElementById('copyPathBtn');

// helpers
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;'); }
function genCode(){ return Math.random().toString(36).slice(2,8).toUpperCase(); }

async function loadAds(){
  try{
    const r = await fetch(ADS_URL, {cache:'no-cache'});
    if(r.ok) ADS = await r.json(); else ADS = [];
  }catch(e){ ADS = []; }
  renderList();
  updateOut();
}

function renderList(){
  const q = (searchEl.value||'').toLowerCase().trim();
  listEl.innerHTML = '';
  ADS.forEach((a, idx) => {
    if(q && !( (a.title||'').toLowerCase().includes(q) || (a.desc||'').toLowerCase().includes(q) || (a.code||'').toLowerCase().includes(q) )) return;
    const d = document.createElement('div'); d.className = 'card';
    d.innerHTML = `
      <img class="thumb" src="${a.img?escapeHtml(a.img):''}" onerror="this.style.opacity=.3" style="width:110px;height:80px;object-fit:cover;border-radius:8px">
      <div class="meta">
        <div style="display:flex;justify-content:space-between;gap:8px;align-items:center">
          <div><strong>${escapeHtml(a.title||a.code)}</strong><div class="small">#${escapeHtml(a.code||'')}</div></div>
          <div class="actions">
            <button data-idx="${idx}" class="editBtn">ØªØ¹Ø¯ÙŠÙ„</button>
            <button data-idx="${idx}" class="delBtn" style="background:#ef4444;color:#fff;border:none;padding:8px;border-radius:8px">Ø­Ø°Ù</button>
          </div>
        </div>
        <div class="small" style="margin-top:6px">${escapeHtml(a.desc||'')}</div>
        <div class="small" style="margin-top:6px">ğŸ“ ${escapeHtml(a.loc||'')} â€¢ ${escapeHtml(a.contact||'')}</div>
        <div class="small" style="margin-top:6px">img: <code>${escapeHtml(a.img||'')}</code></div>
      </div>
    `;
    listEl.appendChild(d);
  });
  // wire buttons
  document.querySelectorAll('.editBtn').forEach(b => b.onclick = e => openEdit(Number(e.target.dataset.idx)));
  document.querySelectorAll('.delBtn').forEach(b => b.onclick = e => { if(confirm('Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ')) { ADS.splice(Number(e.target.dataset.idx),1); renderList(); updateOut(); } });
}

function updateOut(){ outEl.textContent = JSON.stringify(ADS, null, 2); }

newBtn.onclick = () => { editingIndex = -1; openModal(); };
searchEl.addEventListener('input', renderList);

function openModal(item){
  if(typeof item === 'number'){ // editing index
    editingIndex = item;
    const a = ADS[item];
    mTitle.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ù„Ø§Ù†';
    m_code.value = a.code || '';
    m_title.value = a.title || '';
    m_desc.value = a.desc || '';
    m_loc.value = a.loc || '';
    m_contact.value = a.contact || '';
    m_cat.value = a.cat || '';
    m_imgpath.value = a.img || '';
    imgPreview.innerHTML = a.img ? `<img src="${a.img}" style="max-width:160px;border-radius:8px">` : '';
  } else {
    editingIndex = -1;
    mTitle.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯';
    m_code.value = ''; m_title.value=''; m_desc.value=''; m_loc.value=''; m_contact.value=''; m_cat.value=''; m_imgpath.value=''; imgPreview.innerHTML='';
  }
  modal.style.display = 'flex'; modal.setAttribute('aria-hidden','false');
}
function openEdit(idx){ openModal(idx); }

cancelBtn.onclick = () => { modal.style.display = 'none'; modal.setAttribute('aria-hidden','true'); };

m_file.addEventListener('change', (ev) => {
  const f = ev.target.files[0];
  imgPreview.innerHTML = '';
  if(!f) return;
  const img = document.createElement('img');
  img.className = 'thumb';
  img.src = URL.createObjectURL(f);
  img.style.maxWidth = '160px';
  img.style.borderRadius = '8px';
  imgPreview.appendChild(img);
  // suggest path
  const clean = f.name.replace(/\s+/g,'_');
  m_imgpath.value = 'images/' + clean;
});

saveBtn.onclick = () => {
  const obj = {
    code: (m_code.value.trim() || genCode()),
    title: m_title.value.trim(),
    desc: m_desc.value.trim(),
    loc: m_loc.value.trim(),
    contact: m_contact.value.trim(),
    cat: m_cat.value.trim(),
    img: m_imgpath.value.trim(),
    created_at: new Date().toISOString()
  };
  if(editingIndex >= 0){ ADS[editingIndex] = obj; } else { ADS.unshift(obj); }
  modal.style.display = 'none';
  updateOut(); renderList(); modal.setAttribute('aria-hidden','true');
};

// download ads.json
downloadBtn.onclick = () => {
  const blob = new Blob([JSON.stringify(ADS, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'ads.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
};

// copy JSON
copyBtn.onclick = async () => {
  try { await navigator.clipboard.writeText(JSON.stringify(ADS, null, 2)); alert('ØªÙ… Ù†Ø³Ø® JSON'); } catch(e){ alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®'); }
};

// download selected image for repo
downloadImgBtn.onclick = () => {
  const f = m_file.files[0];
  if(!f) return alert('Ø§Ø®ØªØ± Ù…Ù„ÙØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹');
  const suggestedName = m_imgpath.value.trim() || ('images/' + f.name.replace(/\s+/g,'_'));
  const clean = suggestedName.split('/').pop();
  const blob = new Blob([f], {type: f.type});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = clean; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  alert('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù. Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ø§ØªØ¬ Ø¥Ù„Ù‰ public/images/ ÙÙŠ Ø§Ù„Ø±ÙŠØ¨Ùˆ Ø¹Ø¨Ø± GitHub Ø«Ù… Ø¶ÙØ¹ Ù†ÙØ³ Ø§Ù„Ù…Ø³Ø§Ø± ÙÙŠ Ø­Ù‚Ù„ Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø©.');
};

// copy image path to clipboard
copyPathBtn.onclick = async () => {
  const path = m_imgpath.value.trim();
  if(!path) return alert('Ø£Ø¯Ø®Ù„ Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
  try { await navigator.clipboard.writeText(path); alert('ØªÙ… Ù†Ø³Ø® Ù…Ø³Ø§Ø± Ø§Ù„ØµÙˆØ±Ø©'); } catch(e){ alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®'); }
};

// initial load
loadAds();
</script>
</body>
</html>
