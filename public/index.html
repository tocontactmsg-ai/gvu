<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø³ÙˆÙ‚ Ù…Ø¨ÙˆØ¨</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --accent:#0078d7;
    --muted:#6b7280;
    --card-bg:#ffffff;
    --bg:#f3f6fb;
  }
  *{box-sizing:border-box;font-family:"Tajawal",system-ui,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:#0b1320}
  .container{max-width:1100px;margin:18px auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:54px;height:54px;border-radius:10px;background:linear-gradient(135deg,#0ea5e9,#06b6d4);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
  h1{margin:0;font-size:20px}
  .controls{display:flex;gap:10px;margin-top:12px;align-items:center}
  input[type="search"]{flex:1;padding:10px;border-radius:8px;border:1px solid #e6eef8;background:#fff}
  select{padding:10px;border-radius:8px;border:1px solid #e6eef8;background:#fff}
  .wa-send{background:#25D366;color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}
  .grid{display:grid;grid-template-columns:repeat(1,1fr);gap:14px;margin-top:18px}
  @media(min-width:680px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media(min-width:980px){.grid{grid-template-columns:repeat(3,1fr)}}
  .card{background:var(--card-bg);border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(2,6,23,0.06);display:flex;flex-direction:column}
  .media{height:180px;background:#eef3fb;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .media img{width:100%;height:100%;object-fit:cover;display:block}
  .body{padding:12px;flex:1;display:flex;flex-direction:column}
  .title{font-weight:700;margin-bottom:6px}
  .desc{color:var(--muted);font-size:14px;line-height:1.3;margin-bottom:10px;flex:1}
  .meta{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .code{background:#e9f6ff;color:var(--accent);padding:6px;border-radius:8px;direction:ltr;font-weight:600}
  footer.small{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  .noitems{text-align:center;padding:28px;color:var(--muted)}
  /* light button styles */
  .btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
  .ghost{background:#fff;color:var(--accent);border:1px solid #dbeafe}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="brand">
      <div class="logo">Ø¯</div>
      <div>
        <h1>Ø³ÙˆÙ‚ Ù…Ø¨ÙˆØ¨</h1>
        <div style="color:var(--muted);font-size:13px">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª â€” Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª</div>
      </div>
    </div>

    <div style="display:flex;gap:10px;align-items:center">
      <a class="ghost" href="admin.html" style="text-decoration:none;padding:8px 12px;border-radius:8px;color:var(--accent);">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
    </div>
  </header>

  <div class="controls" style="margin-top:14px">
    <input id="search" type="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„ÙˆØµÙ Ø£Ùˆ Ø§Ù„Ø±Ù…Ø² Ø£Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹">
    <select id="catFilter">
      <option value="">ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>
    </select>

    <!-- WhatsApp button: edit PHONE_NUMBER constant below if needed -->
    <button id="waBtn" class="wa-send" title="Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨">Ø£Ø±Ø³Ù„ Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
  </div>

  <main>
    <div id="grid" class="grid" aria-live="polite"></div>
    <div id="noitems" class="noitems" style="display:none">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div>
  </main>

  <footer class="small">
    Ù…ÙˆÙ‚Ø¹ Ø«Ø§Ø¨Øª ÙŠØ¹Ù…Ù„ Ø¹Ø¨Ø± GitHub Pages â€” Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù‚Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ ads.json ÙˆØ±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ public/images/.
  </footer>
</div>

<script>
/*
  CONFIG:
  - Set WHATSAPP_NUMBER to the full international number (digits only) you want the WA link to open.
    Example for +249 964 147 954 -> '249964147954'
  - The message text is "hi i want to post" per your request.
*/
const WHATSAPP_NUMBER = '249964147954'; // <-- change this if you want
const WA_MESSAGE = 'hi i want to post';

const ADS_URL = 'ads.json';
const IMG_PREFIX = 'images/';

const grid = document.getElementById('grid');
const noitems = document.getElementById('noitems');
const searchEl = document.getElementById('search');
const catFilter = document.getElementById('catFilter');
const waBtn = document.getElementById('waBtn');

let ADS = [];

function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

async function loadAds(){
  try {
    const r = await fetch(ADS_URL, {cache:'no-cache'});
    if(!r.ok) throw new Error('ads.json not found');
    ADS = await r.json();
    // normalize created_at
    ADS = ADS.map(a => Object.assign({}, a, { created_at: a.created_at || new Date().toISOString() }));
    ADS.sort((a,b) => new Date(b.created_at) - new Date(a.created_at));
    buildCats();
    render();
  } catch(e){
    console.error(e);
    grid.innerHTML = '<div class="noitems">ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† ads.json Ù…ÙˆØ¬ÙˆØ¯.</div>';
  }
}

function buildCats(){
  const cats = new Set();
  ADS.forEach(a => { if(a.cat) cats.add(a.cat); });
  catFilter.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>';
  Array.from(cats).sort().forEach(c => {
    const o = document.createElement('option'); o.value=c; o.textContent=c; catFilter.appendChild(o);
  });
}

function render(){
  const q = (searchEl.value||'').trim().toLowerCase();
  const cat = catFilter.value;
  let list = ADS.slice();
  if(q) list = list.filter(a => (a.title||'').toLowerCase().includes(q) || (a.desc||'').toLowerCase().includes(q) || (a.loc||'').toLowerCase().includes(q) || (a.code||'').toLowerCase().includes(q));
  if(cat) list = list.filter(a => a.cat === cat);
  grid.innerHTML = '';
  if(list.length === 0){ noitems.style.display='block'; return; }
  noitems.style.display='none';
  list.forEach(a => {
    const el = document.createElement('article');
    el.className = 'card';
    el.innerHTML = `
      <div class="media">${a.img ? `<img data-src="${escapeHtml(a.img)}" alt="${escapeHtml(a.title||'')}" loading="lazy">` : '<div style="color:var(--muted)">'+(a.title||'Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©')+'</div>'}</div>
      <div class="body">
        <div class="title">${escapeHtml(a.title||a.code||'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†')}</div>
        <div class="desc">${escapeHtml(a.desc||'')}</div>
        <div style="margin-top:10px" class="meta">
          <div class="small">ğŸ“ ${escapeHtml(a.loc||'')} â€¢ ${escapeHtml(a.contact||'')}</div>
          <div><span class="code">#${escapeHtml(a.code||'')}</span></div>
        </div>
      </div>
    `;
    grid.appendChild(el);
  });
  // image lazy load
  Array.from(grid.querySelectorAll('img[data-src]')).forEach(img=>{
    if(img.dataset.loaded) return;
    img.src = img.dataset.src;
    img.onload = ()=> img.dataset.loaded = '1';
  });
}

// Events
searchEl.addEventListener('input', () => setTimeout(render, 120));
catFilter.addEventListener('change', render);

waBtn.addEventListener('click', ()=>{
  const text = encodeURIComponent(WA_MESSAGE);
  const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${text}`;
  window.open(url, '_blank');
});

// init
loadAds();
</script>
</body>
</html>
